# GUI 回測使用者介面說明

## 功能概述

`gui_backtest.py` 提供了一個圖形化使用者介面，讓用戶可以：
- 設定所有回測參數（包含 config.py 中的參數）
- 設定回測的開始和結束日期
- 執行回測並查看結果
- 自動打開 Excel 輸出文件

## 使用方法

### 啟動程式

```bash
python gui_backtest.py
```

## 介面說明

### 1. 數據文件路徑
- **數據文件路徑**：選擇包含指數數據的 CSV 文件
- 點擊「瀏覽」按鈕選擇文件
- 預設值：`skills/opsell/assets/TSEA_加權指_日線.csv`

### 2. 策略參數

所有 config.py 中的參數都可以在 GUI 中設定：

- **觸發漲跌幅百分比 (%)**：觸發建立新部位的漲跌幅（預設 3.0）
- **賣出買權權利金點數**：賣出買權收取的權利金點數（預設 400）
- **賣出賣權權利金點數**：賣出賣權收取的權利金點數（預設 600）
- **買入買權避險成本點數**：買入買權避險的成本點數（預設 200）
- **買入賣權避險成本點數**：買入賣權避險的成本點數（預設 200）
- **最大部位數**：每月最多建立的部位數（預設 5）
- **契約乘數**：選擇權契約的乘數（預設 50）

### 3. 回測日期範圍

- **起始年**：開始回測的年（預設 2025）
- **起始月**：開始回測的月（預設 8）
- **結束年**：結束回測的年（預設 2026）
- **結束月**：結束回測的月（預設 1）

### 4. 輸出設定

- **輸出 Excel 文件**：指定輸出文件的路徑和名稱
- 點擊「瀏覽」按鈕選擇保存位置
- 預設值：`backtest_results.xlsx`

## 操作按鈕

### 執行回測
- 點擊「執行回測」按鈕開始回測
- 程序會驗證所有輸入參數
- 執行回測並顯示進度
- 完成後自動打開 Excel 文件

### 重置為預設值
- 點擊「重置為預設值」按鈕
- 所有參數將恢復為預設值

## 輸入驗證

程式會自動驗證以下項目：
- 數據文件路徑是否存在
- 所有參數值是否在有效範圍內
- 起始日期是否早於或等於結束日期

如果驗證失敗，會顯示錯誤訊息。

## 輸出結果

回測完成後：
1. 結果會儲存到指定的 Excel 文件
2. 會顯示完成訊息框
3. 會自動打開 Excel 文件供查看

Excel 文件包含：
- **Tree View** 工作表：顯示詳細部位資訊
  - 月份、部位類型、建立時間、建立時加權指數
  - 履約價、權利金、損益
  - 部位類型用顏色標示：
    - 賣出買權/賣出賣權：淡綠色
    - 避險單：淡紅色
- **Monthly P&L** 工作表：顯示每月損益長條圖

## 注意事項

1. **GUI 依賴**：此程式使用 tkinter，它是 Python 的內置 GUI 庫，無需額外安裝
2. **Excel 自動打開**：須確保系統已安裝可打開 .xlsx 文件的應用程式
3. **路徑格式**：在 Windows 系統中，路徑使用反斜杠 `\` 或正斜杠 `/` 均可
4. **參數範圍**：
   - 觸發漲跌幅百分比：大於 0
   - 年份範圍：2010-2030
   - 月份範圍：1-12
   - 最大部位數：大於 0
   - 契約乘數：大於 0

## 鍵盤快捷鍵

- **Enter 鍵**：當焦點在任何輸入框時，按 Enter 鍵執行回測

## 範例

### 範例 1：使用預設參數
1. 啟動程式：`python gui_backtest.py`
2. 確認所有參數為預設值
3. 點擊「執行回測」
4. 等待完成，自動打開 Excel

### 範例 2：自訂參數
1. 修改觸發漲跌幅百分比為 2.5
2. 修改起始日期為 2025年7月
3. 修改結束日期為 2025年12月
4. 修改輸出文件名稱為 `custom_backtest.xlsx`
5. 點擊「執行回測」

## 故障排除

### 程式無法啟動
- 確保 Python 已安裝 tkinter（通常與 Python 一起安裝）
- 檢查是否有其他 Python 程序佔用 GUI 資源

### Excel 無法自動打開
- 確保系統有預設的 Excel 應用程式
- 手動打開輸出的 Excel 文件

### 回測失敗
- 檢查數據文件格式是否正確
- 確認數據文件包含所有必需的欄位（日期、開盤、最高、最低、收盤）
- 查看錯誤訊息以了解具體問題

## 技術詳情

- **GUI 框架**：tkinter
- **依賴**：pandas, openpyxl, matplotlib
- **Python 版本**：3.7 或以上
- **平台**：Windows, macOS, Linux

## 命令行模式

如果需要使用命令行模式（而非 GUI），請使用：
```bash
python run_backtest.py --data <數據文件> --start-year <起始年> --start-month <起始月> --end-year <結束年> --end-month <結束月>
```

更多命令行參數：
```bash
python run_backtest.py --help
```
